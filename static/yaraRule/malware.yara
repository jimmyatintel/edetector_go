rule KA_uShell_0_1_6 {
   meta:
      description = "test2 - file KA_uShell 0.1.6.php"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2024-01-09"
      hash1 = "06d8c97448db0b9c7790e0d94fcb8db79162ea23ac65f1f74e687f3186017f73"
   strings:
      $s1 = "if(empty($_SERVER['PHP_AUTH_PW']) || $_SERVER['PHP_AUTH_PW']<>$pass || empty($_SERVER['PHP_AUTH_USER']) || $_SERVER['PHP_AUTH_US" ascii /* score: '15.00'*/
      $s2 = "$login = \"admin\";" fullword ascii /* score: '15.00'*/
      $s3 = "//PHP Eval Code execution" fullword ascii /* score: '14.00'*/
      $s4 = "header('WWW-Authenticate: Basic realm=\"KA_uShell\"');" fullword ascii /* score: '13.00'*/
      $s5 = "if (empty($_POST['wser'])) {$wser = \"whois.ripe.net\";} else $wser = $_POST['wser'];" fullword ascii /* score: '12.00'*/
      $s6 = "ER']<>$login)" fullword ascii /* score: '12.00'*/
      $s7 = "passthru($_POST['c']);" fullword ascii /* score: '12.00'*/
      $s8 = "if (!empty($_POST['tot']) && !empty($_POST['tac'])) {" fullword ascii /* score: '12.00'*/
      $s9 = "if (isset($_POST['wq']) && $_POST['wq']<>\"\") {" fullword ascii /* score: '12.00'*/
      $s10 = "if ($_POST['path']==\"\"){$uploadfile = $_FILES['file']['name'];}" fullword ascii /* score: '11.00'*/
      $s11 = ":<b>\" .base64_decode($_POST['tot']). \"</b>\";" fullword ascii /* score: '11.00'*/
      $s12 = "$uploadfile = $_POST['path'].$_FILES['file']['name'];" fullword ascii /* score: '11.00'*/
      $s13 = "elseif (!empty($_POST['ac'])) {$ac = $_POST['ac'];}" fullword ascii /* score: '9.00'*/
      $s14 = "<form action=\"$self\" method=\"POST\">" fullword ascii /* score: '9.00'*/
      $s15 = "if (copy($_FILES['file']['tmp_name'], $uploadfile)) {" fullword ascii /* score: '9.00'*/
      $s16 = "if (isset($_POST['path'])){" fullword ascii /* score: '9.00'*/
      $s17 = "eval($_POST['ephp']);" fullword ascii /* score: '9.00'*/
      $s18 = "if (isset($_POST['ephp'])){" fullword ascii /* score: '9.00'*/
      $s19 = "while(!feof($fp)){echo fgets($fp, 4000);}" fullword ascii /* score: '9.00'*/
      $s20 = "|<a href=$self?ac=shell>Shell</a>|" fullword ascii /* score: '9.00'*/
   condition:
      uint16(0) == 0x213c and filesize < 10KB and
      8 of them
}

rule mimikatz {
   meta:
      description = "test2 - file mimikatz.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2024-01-09"
      hash1 = "6688fb3039ad6df606d76a897ef1072cdc78b928335c6bfa691d99498caf5c4b"
   strings:
      $x1 = "ERROR kuhl_m_lsadump_getUsersAndSamKey ; kull_m_registry_RegOpenKeyEx SAM Accounts (0x%08x)" fullword wide /* score: '46.00'*/
      $x2 = "ERROR kuhl_m_lsadump_getUsersAndSamKey ; kull_m_registry_RegOpenKeyEx user (%s)" fullword wide /* score: '45.00'*/
      $x3 = "ERROR kuhl_m_lsadump_update_dc_password ; A /target argument is needed" fullword wide /* score: '38.00'*/
      $x4 = "ERROR kuhl_m_lsadump_getComputerAndSyskey ; kull_m_registry_RegOpenKeyEx LSA KO" fullword wide /* score: '37.00'*/
      $x5 = "ERROR kuhl_m_lsadump_getUsersAndSamKey ; kuhl_m_lsadump_getSamKey KO" fullword wide /* score: '37.00'*/
      $x6 = "ERROR kuhl_m_lsadump_lsa ; kull_m_process_getVeryBasicModuleInformationsForName (0x%08x)" fullword wide /* score: '37.00'*/
      $x7 = "ERROR kuhl_m_lsadump_lsa_getHandle ; OpenProcess (0x%08x)" fullword wide /* score: '37.00'*/
      $x8 = "ERROR kuhl_m_lsadump_trust ; kull_m_process_getVeryBasicModuleInformationsForName (0x%08x)" fullword wide /* score: '37.00'*/
      $x9 = "ERROR kuhl_m_lsadump_dcsync ; kull_m_rpc_drsr_ProcessGetNCChangesReply" fullword wide /* score: '37.00'*/
      $x10 = "ERROR kuhl_m_dpapi_chrome ; Input 'Login Data' file needed (/in:\"%%localappdata%%\\Google\\Chrome\\User Data\\Default\\Login Da" wide /* score: '34.00'*/
      $x11 = "ERROR kuhl_m_kernel_processProtect ; Argument /process:program.exe or /pid:processid needed" fullword wide /* score: '34.00'*/
      $x12 = "ERROR kuhl_m_lsadump_netsync ; I_NetServerTrustPasswordsGet (0x%08x)" fullword wide /* score: '34.00'*/
      $x13 = "ERROR kull_m_rpc_drsr_ProcessGetNCChangesReply_decrypt ; Checksums don't match (C:0x%08x - R:0x%08x)" fullword wide /* score: '33.00'*/
      $x14 = "ERROR kuhl_m_lsadump_sam ; kull_m_registry_RegOpenKeyEx (SAM) (0x%08x)" fullword wide /* score: '33.00'*/
      $x15 = "ERROR kuhl_m_lsadump_getHash ; Unknow SAM_HASH revision (%hu)" fullword wide /* score: '33.00'*/
      $x16 = "ERROR kuhl_m_lsadump_changentlm ; Argument /oldpassword: or /oldntlm: is needed" fullword wide /* score: '33.00'*/
      $x17 = "ERROR kuhl_m_lsadump_enumdomains_users ; /user or /rid is needed" fullword wide /* score: '33.00'*/
      $x18 = "ERROR kuhl_m_lsadump_zerologon ; Missing /account argument, usually a DC$ account" fullword wide /* score: '33.00'*/
      $x19 = "ERROR kuhl_m_lsadump_update_dc_password ; A /account argument is needed" fullword wide /* score: '33.00'*/
      $x20 = "livessp.dll" fullword wide /* reversed goodware string 'lld.pssevil' */ /* score: '33.00'*/
   condition:
      uint16(0) == 0x5a4d and filesize < 4000KB and
      1 of ($x*)
}

/* Rule Set ----------------------------------------------------------------- */

rule advanced_ip_scanner {
   meta:
      description = "test - file advanced_ip_scanner.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2024-01-09"
      hash1 = "4b036cc9930bb42454172f888b8fde1087797fc0c9d31ab546748bd2496bd3e5"
   strings:
      $x1 = "<assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\" xmlns:asmv3=\"urn:schemas-microsoft-com:asm.v3\"><t" ascii /* score: '35.00'*/
      $s2 = "api-ms-win-core-synch-l1-2-0.dll" fullword wide /* reversed goodware string 'lld.0-2-1l-hcnys-eroc-niw-sm-ipa' */ /* score: '30.00'*/
      $s3 = "fo xmlns=\"urn:schemas-microsoft-com:asm.v3\"><security><requestedPrivileges><requestedExecutionLevel level=\"asInvoker\" uiAcce" ascii /* score: '26.00'*/
      $s4 = "Qt5WinExtras.dll" fullword ascii /* score: '23.00'*/
      $s5 = "Executable files (*.exe)" fullword ascii /* score: '23.00'*/
      $s6 = "RolUpdater.dll" fullword wide /* score: '23.00'*/
      $s7 = "ping.exe" fullword ascii /* score: '22.00'*/
      $s8 = "Radmin.exe" fullword ascii /* score: '22.00'*/
      $s9 = "tracert.exe" fullword ascii /* score: '22.00'*/
      $s10 = "famatech.com" fullword ascii /* score: '21.00'*/
      $s11 = "Qt5Xml.dll" fullword ascii /* score: '20.00'*/
      $s12 = "Z:\\out\\Release\\NetUtils\\x86\\advanced_ip_scanner.pdb" fullword ascii /* score: '20.00'*/
      $s13 = "advanced_ip_scanner.exe" fullword wide /* score: '20.00'*/
      $s14 = "onTargetScanned" fullword ascii /* score: '19.00'*/
      $s15 = "/telnet.exe" fullword ascii /* score: '19.00'*/
      $s16 = "CScanTargetsShared" fullword ascii /* score: '18.00'*/
      $s17 = "http://www.advanced-ip-scanner.com/" fullword ascii /* score: '18.00'*/
      $s18 = "</style></head><body style=\" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:400; font-style:normal;\">" fullword ascii /* score: '17.00'*/
      $s19 = "<a href=\"http://www.radmin.com\">www.radmin.com</a>" fullword wide /* score: '17.00'*/
      $s20 = "OnCommandExportAll" fullword ascii /* score: '15.00'*/
   condition:
      uint16(0) == 0x5a4d and filesize < 5000KB and
      1 of ($x*) and 4 of them
}

rule advanced_ip_scanner_console {
   meta:
      description = "test - file advanced_ip_scanner_console.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2024-01-09"
      hash1 = "be2b45b7df8e7dea6fb6e72d776f41c50686c2c9cfbaf4d456bcc268f10ab083"
   strings:
      $x1 = "<assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\" xmlns:asmv3=\"urn:schemas-microsoft-com:asm.v3\"><t" ascii /* score: '35.00'*/
      $s2 = "fo xmlns=\"urn:schemas-microsoft-com:asm.v3\"><security><requestedPrivileges><requestedExecutionLevel level=\"asInvoker\" uiAcce" ascii /* score: '26.00'*/
      $s3 = "QNetworkSessionPrivateImpl::usagePoliciesChanged(QNetworkSession::UsagePolicies) --> QNetworkSession::usagePoliciesChanged(QNetw" ascii /* score: '24.00'*/
      $s4 = "QNetworkSessionPrivateImpl::usagePoliciesChanged(QNetworkSession::UsagePolicies) --> QNetworkSession::usagePoliciesChanged(QNetw" ascii /* score: '24.00'*/
      $s5 = "rRolUpdater.dll" fullword wide /* score: '23.00'*/
      $s6 = "QNetworkSessionPrivateImpl::error(QNetworkSession::SessionError) --> QNetworkSession::error(QNetworkSession::SessionError)" fullword ascii /* score: '22.00'*/
      $s7 = "famatech.com" fullword ascii /* score: '21.00'*/
      $s8 = "/r - address or range of IP addresses to scan, ex 192.168.0.1-192.168.0.255" fullword ascii /* score: '21.00'*/
      $s9 = "advanced_ip_scanner_console.exe /r:192.168.0.1-192.168.0.255" fullword ascii /* score: '21.00'*/
      $s10 = "Z:\\out\\Release\\NetUtils\\x86\\advanced_ip_scanner_console.pdb" fullword ascii /* score: '20.00'*/
      $s11 = "advanced_ip_scanner_console.exe /s:ip_ranges.txt /f:scan_results.txt" fullword ascii /* score: '20.00'*/
      $s12 = "advanced_ip_scanner_console.exe" fullword wide /* score: '20.00'*/
      $s13 = "onTargetScanned" fullword ascii /* score: '19.00'*/
      $s14 = "QNetworkSessionPrivateImpl::stateChanged(QNetworkSession::State) --> QNetworkSession::stateChanged(QNetworkSession::State)" fullword ascii /* score: '19.00'*/
      $s15 = "CScanTargetsShared" fullword ascii /* score: '18.00'*/
      $s16 = "OnScanProcessStopped" fullword ascii /* score: '16.00'*/
      $s17 = "/v - show results of service scan (/v2 to show grouped)" fullword ascii /* score: '16.00'*/
      $s18 = "Capi-ms-win-core-synch-l1-2-0.dll" fullword wide /* score: '16.00'*/
      $s19 = "i_oScanTargets" fullword ascii /* score: '15.00'*/
      $s20 = "(Symantec SHA256 TimeStamping Signer - G30" fullword ascii /* score: '15.00'*/
   condition:
      uint16(0) == 0x5a4d and filesize < 1000KB and
      1 of ($x*) and 4 of them
}

/* Super Rules ------------------------------------------------------------- */

rule _advanced_ip_scanner_advanced_ip_scanner_console_0 {
   meta:
      description = "test - from files advanced_ip_scanner.exe, advanced_ip_scanner_console.exe"
      author = "yarGen Rule Generator"
      reference = "https://github.com/Neo23x0/yarGen"
      date = "2024-01-09"
      hash1 = "4b036cc9930bb42454172f888b8fde1087797fc0c9d31ab546748bd2496bd3e5"
      hash2 = "be2b45b7df8e7dea6fb6e72d776f41c50686c2c9cfbaf4d456bcc268f10ab083"
   strings:
      $x1 = "<assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\" xmlns:asmv3=\"urn:schemas-microsoft-com:asm.v3\"><t" ascii /* score: '35.00'*/
      $s2 = "fo xmlns=\"urn:schemas-microsoft-com:asm.v3\"><security><requestedPrivileges><requestedExecutionLevel level=\"asInvoker\" uiAcce" ascii /* score: '26.00'*/
      $s3 = "famatech.com" fullword ascii /* score: '21.00'*/
      $s4 = "onTargetScanned" fullword ascii /* score: '19.00'*/
      $s5 = "CScanTargetsShared" fullword ascii /* score: '18.00'*/
      $s6 = "i_oScanTargets" fullword ascii /* score: '15.00'*/
      $s7 = "(Symantec SHA256 TimeStamping Signer - G30" fullword ascii /* score: '15.00'*/
      $s8 = "(Symantec SHA256 TimeStamping Signer - G3" fullword ascii /* score: '15.00'*/
      $s9 = "\"http://www.advanced-ip-scanner.com0" fullword ascii /* score: '15.00'*/
      $s10 = "false\"></requestedExecutionLevel></requestedPrivileges></security></trustInfo><asmv3:application><asmv3:windowsSettings xmlns=" ascii /* score: '15.00'*/
      $s11 = "?connectToHostEncrypted@QSslSocket@@QAEXABVQString@@GV?$QFlags@W4OpenModeFlag@QIODevice@@@@W4NetworkLayerProtocol@QAbstractSocke" ascii /* score: '14.00'*/
      $s12 = "onTargetFinished" fullword ascii /* score: '14.00'*/
      $s13 = "system.sysName.0" fullword ascii /* score: '14.00'*/
      $s14 = "finishedTarget" fullword ascii /* score: '14.00'*/
      $s15 = "sSELECT * FROM Win32_ComputerSystem" fullword wide /* score: '14.00'*/
      $s16 = "portsScan_GetCorrespondingStateObject" fullword ascii /* score: '13.00'*/
      $s17 = "<meta http-equiv=\"content-type\" content=\"text/html; charset=" fullword ascii /* score: '12.00'*/
      $s18 = "No error occures during last operation" fullword ascii /* score: '12.00'*/
      $s19 = "DEC Pathworks TCPIP service on Windows NT" fullword ascii /* score: '12.00'*/
      $s20 = "GET / HTTP/1.1" fullword ascii /* score: '12.00'*/
   condition:
      ( uint16(0) == 0x5a4d and filesize < 5000KB and ( 1 of ($x*) and 4 of them )
      ) or ( all of them )
}

